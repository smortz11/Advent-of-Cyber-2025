Welcome to day six of the Advent of Cyber! Today, based on the title, we are going to be performing malware analysis. More specifically, the topics of the room include the principles of malware analysis, an intro to sandboxes, ie where we will be conducting analysis on the malware, static vs dynamic analysis, and the different tools used, such as PeStudio, ProcMon, and Regshot. We can start the room along with the VM. Let' s get started!

Within malware analysis, there are two primary means of analysis, static and dynamic. Static analysis includes techniques that do not include the execution of a file whereas dynamic analysis involves execution.

More often than not, all of our analysis will take place in a sandbox. These are safe, isolated environments. It is important that we never run dangerous applications on devices that we care about. VM's are, pretty much, the golden standard for this.

Starting with static analysis, there are many things we have at our disposal. First of all, we can check online for its checksum. We have strings to scan the file for potential words and sequences, and imports. Imports are libraries used by the application, which could give us further insight into its uses. Note that many adversaries will obfuscate functions and include red herrings.

We will perform some static analysis using pestudio. Inside pestudio, we can load up our executable and find a plethora of information. We can immediately see the SHA256Sum in the right column, which gives us the answer to Q1. We can also view other information about the exectuable. Namely, the `strings` column on the left gives us the strings output of the malware, which also gives us the answer to Q2.

Now, we are moving into the dynamic analysis of our malware. We will be doing so with Regshot. With Regshot, we are taking a baseline of our registry values and comparing them after the malware runs in order to give us insight into how it works. After grabbing our first baseline, we run our malware, which funnily changes the icons of our shortcuts to eggs. We can now use Regshot to grab the registry values and compare them. After searching our registry values, we can see one that adds a Run value, which enables persistence, the solution to Q3.

Next up in our dynamic analysis, we will be using Procmon. Procmon allows us to look at all processes going on in the OS of a device and filter and investigate them. Once we open Procmon, we can run the malware and stop the caputer via the start button in the top bar. Doing so, we can navigate to filters and add a filter where the process name is equal to `HopHelper.exe`. Further, we can apply other filters, ie, ones that would allow us to complete Q4. Applying the new filter and investigating the process allows us to see the four-lettered TCP protocol.
### Q1: What is the SHA256Sum of the HopHelper.exe?
pestudio -> load HopHelper.exe -> left column.

### Q2: Within the strings of HopHelper.exe, a flag exists. What is it?
In pestudio, use the strings in the left column

### Q3: What registry value has the HopHelper.exe modified for persistence?
Use regshot, running a shot before executing the malware, and again afterwards. We can use the comparison feature to see which of the registry values contains "Run".

### Q4: Filter the output of ProcMon for "TCP" operations. What network protocol is HopHelper.exe using to communicate?
Procmon -> filter TCP